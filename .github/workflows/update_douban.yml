name: Update Douban Feed

# 自动触发设置
on:
  schedule:
    - cron: "0 2 * * *" # 每天早上10点 (UTC+8) 自动运行
  workflow_dispatch: # 支持手动触发

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write # 授予对仓库内容的写权限

    steps:
      # 拉取仓库
      - uses: actions/checkout@v3

      # 设置 Python 环境
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      # 安装依赖
      - name: Install dependencies
        run: pip install feedparser

      # 执行更新脚本
      - name: Run update script
        run: python scripts/fetch_douban.py

      # 仅在有改动时提交并推送
      - name: Commit and Push changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          if [ -n "$(git status --porcelain)" ]; then
            git add .
            git commit -m "Update Douban feed"
            git push
          else
            echo "No changes to commit"
          fi
